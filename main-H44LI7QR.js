import{a as V,b as F,c as H,e as U}from"./chunk-RXEW4OIM.js";import{a as Q,b as $}from"./chunk-WQ3VCTGI.js";import{a as j,b as z,c as Y,d as X,g as J,n as K}from"./chunk-VYVEJNHN.js";import{Ca as l,Ma as E,Nb as N,Ob as B,Pb as L,Qb as Z,Ra as D,Va as x,W as k,a as T,ab as g,bb as r,cb as a,db as W,ea as _,eb as O,fa as y,fb as A,gb as d,hb as S,jb as s,la as h,lb as v,qb as b,rb as I,sb as G,ub as q}from"./chunk-HPGJ3KMS.js";var tt=[{path:"books",loadComponent:()=>import("./chunk-X6SJAJE5.js").then(e=>e.BooksMenuComponent)},{path:"books/add",loadComponent:()=>import("./chunk-5OUUJWDV.js").then(e=>e.AddBookComponent)},{path:"books/list",loadComponent:()=>import("./chunk-IHQV5YXN.js").then(e=>e.BookListComponent)}];var et={providers:[q({eventCoalescing:!0}),U(tt),j(()=>z($.firebase)),Y(()=>X()),J(()=>K())]};var R=class e{position=h(null);error=h(null);accuracy=h(null);watchId=null;readingBuffer=[];MAX_BUFFER_SIZE=5;calculateDistance(i,t,o,n){let p=i*Math.PI/180,u=o*Math.PI/180,f=(o-i)*Math.PI/180,w=(n-t)*Math.PI/180,C=Math.sin(f/2)*Math.sin(f/2)+Math.cos(p)*Math.cos(u)*Math.sin(w/2)*Math.sin(w/2);return 6371e3*(2*Math.atan2(Math.sqrt(C),Math.sqrt(1-C)))}isWithinRadius(i,t,o){let n=this.position();return n?this.calculateDistance(n.lat,n.lng,i,t)<=o:!1}averageReadings(i){if(i.length===0)throw new Error("No readings to average");let t=i.reduce((p,u)=>p+u.lat,0)/i.length,o=i.reduce((p,u)=>p+u.lng,0)/i.length,n=i.reduce((p,u)=>p+(u.accuracy||0),0)/i.length,c=i[i.length-1].timestamp;return{lat:t,lng:o,accuracy:n,timestamp:c}}getCurrentPositionHighAccuracy(){return new Promise((i,t)=>{if(!("geolocation"in navigator)){this.error.set("Geolocation not supported by this browser."),t(new Error("Geolocation not supported"));return}let o={enableHighAccuracy:!0,timeout:6e4,maximumAge:0},n=0;this.readingBuffer=[];let c=null,p=null,u=!1,f=()=>{if(c!==null&&navigator.geolocation.clearWatch(c),p!==null&&clearTimeout(p),this.readingBuffer.length>0){let m=this.averageReadings(this.readingBuffer);this.position.set(m),this.accuracy.set(m.accuracy??null),this.error.set(null),this.readingBuffer=[],i()}else this.error.set("Failed to get accurate position"),t(new Error("No position data"))},w=m=>{let M=m.coords.accuracy;M<100&&(u=!0),u&&(this.readingBuffer.push({lat:m.coords.latitude,lng:m.coords.longitude,accuracy:M,timestamp:m.timestamp}),n++,n>=3&&f())},C=m=>{};c=navigator.geolocation.watchPosition(w,C,o),p=setTimeout(()=>{f()},2e4)})}getCurrentPosition(i){return new Promise((t,o)=>{if(!("geolocation"in navigator)){this.error.set("Geolocation not supported by this browser."),o(new Error("Geolocation not supported"));return}let n=T({enableHighAccuracy:!0,timeout:15e3,maximumAge:0},i);navigator.geolocation.getCurrentPosition(c=>{this.position.set({lat:c.coords.latitude,lng:c.coords.longitude,accuracy:c.coords.accuracy,timestamp:c.timestamp}),this.accuracy.set(c.coords.accuracy),this.error.set(null),t()},c=>{this.error.set(c?.message??"Unknown geolocation error"),o(c)},n)})}startWatching(i){if(!("geolocation"in navigator)){this.error.set("Geolocation not supported by this browser.");return}if(this.watchId!=null)return;let t=T({enableHighAccuracy:!0,timeout:15e3,maximumAge:0},i);this.watchId=navigator.geolocation.watchPosition(o=>{this.position.set({lat:o.coords.latitude,lng:o.coords.longitude,accuracy:o.coords.accuracy,timestamp:o.timestamp}),this.accuracy.set(o.coords.accuracy),this.error.set(null)},o=>{this.error.set(o?.message??"Unknown geolocation error")},t)}stopWatching(){this.watchId!=null&&"geolocation"in navigator&&(navigator.geolocation.clearWatch(this.watchId),this.watchId=null)}static \u0275fac=function(t){return new(t||e)};static \u0275prov=k({token:e,factory:e.\u0275fac,providedIn:"root"})};function nt(e,i){e&1&&(r(0,"div")(1,"div"),s(2,"\u{1F504} Requesting your location..."),a()())}function rt(e,i){e&1&&(r(0,"div",10)(1,"div"),s(2,"\u2705 You are within the allowed zone! You can upload photos."),a()())}function at(e,i){e&1&&(r(0,"div",11)(1,"div"),s(2,"\u274C You are outside the allowed zone (300m radius). Please move closer."),a()())}function ct(e,i){if(e&1&&(r(0,"div"),x(1,rt,3,0,"div",9)(2,at,3,0,"ng-template",null,1,G),a()),e&2){let t=S(3),o=d(2);l(),g("ngIf",o.isWithinAllowedZone())("ngIfElse",t)}}function st(e,i){if(e&1&&(r(0,"div"),s(1,"Accuracy: "),r(2,"strong"),s(3),b(4,"number"),a()()),e&2){let t=d(3);l(3),v("",I(4,1,t.accuracy(),"1.0-2")," m")}}function lt(e,i){if(e&1&&(r(0,"div"),s(1),b(2,"date"),a()),e&2){let t=d().ngIf;l(),v("At: ",I(2,1,t.timestamp,"medium"))}}function pt(e,i){if(e&1&&(r(0,"div")(1,"div"),s(2),b(3,"number"),a(),r(4,"div"),s(5),b(6,"number"),a(),x(7,st,5,4,"div",4)(8,lt,3,4,"div",4),a()),e&2){let t=i.ngIf,o=d(2);l(2),v("Latitude: ",I(3,4,t.lat,"1.6-6")),l(3),v("Longitude: ",I(6,7,t.lng,"1.6-6")),l(2),g("ngIf",o.accuracy()!==null),l(),g("ngIf",t.timestamp)}}function ut(e,i){e&1&&(r(0,"div"),s(1,"No position yet."),a())}function dt(e,i){if(e&1&&(r(0,"div",12),s(1),a()),e&2){let t=i.ngIf;l(),v("Error: ",t)}}function mt(e,i){if(e&1){let t=O();r(0,"div",3)(1,"h4"),s(2,"Geolocation"),a(),x(3,nt,3,0,"div",4)(4,ct,4,2,"div",4)(5,pt,9,10,"div",5)(6,ut,2,0,"ng-template",null,0,G)(8,dt,2,1,"div",6),r(9,"div",7)(10,"button",8),A("click",function(){_(t);let n=d();return y(n.requestOnce())}),s(11,"Get current position"),a(),r(12,"button",8),A("click",function(){_(t);let n=d();return y(n.requestHighAccuracy())}),s(13,"Get high-accuracy position (averaged)"),a(),r(14,"button",8),A("click",function(){_(t);let n=d();return y(n.startWatch())}),s(15,"Start watching"),a(),r(16,"button",8),A("click",function(){_(t);let n=d();return y(n.stopWatch())}),s(17,"Stop watching"),a()()()}if(e&2){let t=S(7),o=d();l(3),g("ngIf",!o.locationRequested()),l(),g("ngIf",o.locationRequested()),l(),g("ngIf",o.position())("ngIfElse",t),l(3),g("ngIf",o.error())}}var P=class e{constructor(i,t,o){this.geolocation=i;this.locationGate=t;this.router=o}title=h("myapp");TARGET_LAT=52.06515920842456;TARGET_LNG=17.238991318103608;RADIUS_METERS=300;isWithinAllowedZone=h(!1);locationRequested=h(!1);ngOnInit(){this.geolocation.getCurrentPositionHighAccuracy().then(()=>{this.locationRequested.set(!0),this.locationGate.locationRequested.set(!0),this.checkProximity()}).catch(()=>{this.locationRequested.set(!0),this.locationGate.locationRequested.set(!0)})}checkProximity(){let i=this.geolocation.isWithinRadius(this.TARGET_LAT,this.TARGET_LNG,this.RADIUS_METERS);this.isWithinAllowedZone.set(i),this.locationGate.isWithinAllowedZone.set(i),i&&this.router.navigate(["/books"]).catch(t=>console.error("Navigation error",t))}ngOnDestroy(){this.geolocation.stopWatching()}requestOnce(){this.geolocation.getCurrentPosition().then(()=>{this.checkProximity()}).catch(()=>{})}requestHighAccuracy(){this.geolocation.getCurrentPositionHighAccuracy().then(()=>{this.checkProximity()}).catch(()=>{})}startWatch(){this.geolocation.startWatching()}stopWatch(){this.geolocation.stopWatching()}get position(){return this.geolocation.position}get error(){return this.geolocation.error}get accuracy(){return this.geolocation.accuracy}static \u0275fac=function(t){return new(t||e)(E(R),E(Q),E(H))};static \u0275cmp=D({type:e,selectors:[["app-root"]],decls:2,vars:1,consts:[["noPos",""],["outsideZone",""],["class","geo",4,"ngIf"],[1,"geo"],[4,"ngIf"],[4,"ngIf","ngIfElse"],["class","error",4,"ngIf"],[1,"geo-controls"],[3,"click"],["class","location-allowed",4,"ngIf","ngIfElse"],[1,"location-allowed"],[1,"location-denied"],[1,"error"]],template:function(t,o){t&1&&(x(0,mt,18,5,"div",2),W(1,"router-outlet")),t&2&&g("ngIf",!o.isWithinAllowedZone())},dependencies:[F,Z,N,L,B],encapsulation:2})};V(P,et).catch(e=>console.error(e));
