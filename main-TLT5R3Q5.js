import{a as Z,b as F,c as H,e as U}from"./chunk-RXEW4OIM.js";import{a as Q,b as $}from"./chunk-L2DRCOS7.js";import{a as j,b as z,c as Y,d as X,g as J,n as K}from"./chunk-VYVEJNHN.js";import{Ca as l,Ma as C,Nb as L,Ob as O,Pb as q,Qb as V,Ra as D,Va as x,W as M,a as T,ab as h,bb as r,cb as a,db as W,ea as v,eb as N,fa as f,fb as _,gb as u,hb as S,jb as c,la as g,lb as y,qb as A,rb as I,sb as k,ub as B}from"./chunk-HPGJ3KMS.js";var tt=[{path:"books",loadComponent:()=>import("./chunk-X6SJAJE5.js").then(i=>i.BooksMenuComponent)},{path:"books/add",loadComponent:()=>import("./chunk-EQF6YC5C.js").then(i=>i.AddBookComponent)},{path:"books/list",loadComponent:()=>import("./chunk-IHQV5YXN.js").then(i=>i.BookListComponent)}];var et={providers:[B({eventCoalescing:!0}),U(tt),j(()=>z($.firebase)),Y(()=>X()),J(()=>K())]};var R=class i{position=g(null);error=g(null);accuracy=g(null);watchId=null;readingBuffer=[];MAX_BUFFER_SIZE=5;calculateDistance(t,e,o,n){let p=t*Math.PI/180,d=o*Math.PI/180,b=(o-t)*Math.PI/180,w=(n-e)*Math.PI/180,E=Math.sin(b/2)*Math.sin(b/2)+Math.cos(p)*Math.cos(d)*Math.sin(w/2)*Math.sin(w/2);return 6371e3*(2*Math.atan2(Math.sqrt(E),Math.sqrt(1-E)))}isWithinRadius(t,e,o){let n=this.position();return n?this.calculateDistance(n.lat,n.lng,t,e)<=o:!1}averageReadings(t){if(t.length===0)throw new Error("No readings to average");let e=t.reduce((p,d)=>p+d.lat,0)/t.length,o=t.reduce((p,d)=>p+d.lng,0)/t.length,n=t.reduce((p,d)=>p+(d.accuracy||0),0)/t.length,s=t[t.length-1].timestamp;return{lat:e,lng:o,accuracy:n,timestamp:s}}getCurrentPositionHighAccuracy(){return new Promise((t,e)=>{if(!("geolocation"in navigator)){this.error.set("Geolocation not supported by this browser."),e(new Error("Geolocation not supported"));return}let o={enableHighAccuracy:!0,timeout:6e4,maximumAge:0},n=0;this.readingBuffer=[];let s=null,p=null,d=!1,b=()=>{if(s!==null&&navigator.geolocation.clearWatch(s),p!==null&&clearTimeout(p),this.readingBuffer.length>0){let m=this.averageReadings(this.readingBuffer);this.position.set(m),this.accuracy.set(m.accuracy??null),this.error.set(null),this.readingBuffer=[],t()}else this.error.set("Failed to get accurate position"),e(new Error("No position data"))},w=m=>{let G=m.coords.accuracy;G<100&&(d=!0),d&&(this.readingBuffer.push({lat:m.coords.latitude,lng:m.coords.longitude,accuracy:G,timestamp:m.timestamp}),n++,n>=3&&b())},E=m=>{};s=navigator.geolocation.watchPosition(w,E,o),p=setTimeout(()=>{b()},2e4)})}getCurrentPosition(t){return new Promise((e,o)=>{if(!("geolocation"in navigator)){this.error.set("Geolocation not supported by this browser."),o(new Error("Geolocation not supported"));return}let n=T({enableHighAccuracy:!0,timeout:15e3,maximumAge:0},t);navigator.geolocation.getCurrentPosition(s=>{this.position.set({lat:s.coords.latitude,lng:s.coords.longitude,accuracy:s.coords.accuracy,timestamp:s.timestamp}),this.accuracy.set(s.coords.accuracy),this.error.set(null),e()},s=>{this.error.set(s?.message??"Unknown geolocation error"),o(s)},n)})}startWatching(t){if(!("geolocation"in navigator)){this.error.set("Geolocation not supported by this browser.");return}if(this.watchId!=null)return;let e=T({enableHighAccuracy:!0,timeout:15e3,maximumAge:0},t);this.watchId=navigator.geolocation.watchPosition(o=>{this.position.set({lat:o.coords.latitude,lng:o.coords.longitude,accuracy:o.coords.accuracy,timestamp:o.timestamp}),this.accuracy.set(o.coords.accuracy),this.error.set(null)},o=>{this.error.set(o?.message??"Unknown geolocation error")},e)}stopWatching(){this.watchId!=null&&"geolocation"in navigator&&(navigator.geolocation.clearWatch(this.watchId),this.watchId=null)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=M({token:i,factory:i.\u0275fac,providedIn:"root"})};function nt(i,t){i&1&&(r(0,"div")(1,"div"),c(2,"\u{1F504} Requesting your location..."),a()())}function rt(i,t){i&1&&(r(0,"div",11)(1,"div"),c(2,"\u2705 You are within the allowed zone! You can upload photos."),a()())}function at(i,t){i&1&&(r(0,"div",12)(1,"div"),c(2,"\u274C You are outside the allowed zone (300m radius). Please move closer."),a()())}function ct(i,t){if(i&1&&(r(0,"div"),x(1,rt,3,0,"div",10)(2,at,3,0,"ng-template",null,1,k),a()),i&2){let e=S(3),o=u(2);l(),h("ngIf",o.isWithinAllowedZone())("ngIfElse",e)}}function st(i,t){if(i&1&&(r(0,"div"),c(1,"Accuracy: "),r(2,"strong"),c(3),A(4,"number"),a()()),i&2){let e=u(3);l(3),y("",I(4,1,e.accuracy(),"1.0-2")," m")}}function lt(i,t){if(i&1&&(r(0,"div"),c(1),A(2,"date"),a()),i&2){let e=u().ngIf;l(),y("At: ",I(2,1,e.timestamp,"medium"))}}function pt(i,t){if(i&1&&(r(0,"div")(1,"div"),c(2),A(3,"number"),a(),r(4,"div"),c(5),A(6,"number"),a(),x(7,st,5,4,"div",4)(8,lt,3,4,"div",4),a()),i&2){let e=t.ngIf,o=u(2);l(2),y("Latitude: ",I(3,4,e.lat,"1.6-6")),l(3),y("Longitude: ",I(6,7,e.lng,"1.6-6")),l(2),h("ngIf",o.accuracy()!==null),l(),h("ngIf",e.timestamp)}}function ut(i,t){i&1&&(r(0,"div"),c(1,"No position yet."),a())}function dt(i,t){if(i&1&&(r(0,"div",13),c(1),a()),i&2){let e=t.ngIf;l(),y("Error: ",e)}}function mt(i,t){if(i&1){let e=N();r(0,"div",3)(1,"h4"),c(2,"Geolocation"),a(),x(3,nt,3,0,"div",4)(4,ct,4,2,"div",4)(5,pt,9,10,"div",5)(6,ut,2,0,"ng-template",null,0,k)(8,dt,2,1,"div",6),r(9,"div",7)(10,"button",8),_("click",function(){v(e);let n=u();return f(n.requestOnce())}),c(11,"Get current position"),a(),r(12,"button",8),_("click",function(){v(e);let n=u();return f(n.requestHighAccuracy())}),c(13,"Get high-accuracy position (averaged)"),a(),r(14,"button",8),_("click",function(){v(e);let n=u();return f(n.startWatch())}),c(15,"Start watching"),a(),r(16,"button",8),_("click",function(){v(e);let n=u();return f(n.stopWatch())}),c(17,"Stop watching"),a(),r(18,"button",9),_("click",function(){v(e);let n=u();return f(n.bypassLocationCheck())}),c(19,"Bypass location check"),a()()()}if(i&2){let e=S(7),o=u();l(3),h("ngIf",!o.locationRequested()),l(),h("ngIf",o.locationRequested()),l(),h("ngIf",o.position())("ngIfElse",e),l(3),h("ngIf",o.error())}}var P=class i{constructor(t,e,o){this.geolocation=t;this.locationGate=e;this.router=o}title=g("myapp");TARGET_LAT=52.06515920842456;TARGET_LNG=17.238991318103608;RADIUS_METERS=300;isWithinAllowedZone=g(!1);locationRequested=g(!1);bypassEnabled=g(!1);ngOnInit(){this.geolocation.getCurrentPositionHighAccuracy().then(()=>{this.locationRequested.set(!0),this.locationGate.locationRequested.set(!0),this.checkProximity()}).catch(()=>{this.locationRequested.set(!0),this.locationGate.locationRequested.set(!0)})}checkProximity(){let t=this.geolocation.isWithinRadius(this.TARGET_LAT,this.TARGET_LNG,this.RADIUS_METERS);this.isWithinAllowedZone.set(t),this.locationGate.isWithinAllowedZone.set(t),t&&this.router.navigate(["/books"]).catch(e=>console.error("Navigation error",e))}ngOnDestroy(){this.geolocation.stopWatching()}requestOnce(){this.geolocation.getCurrentPosition().then(()=>{this.checkProximity()}).catch(()=>{})}requestHighAccuracy(){this.geolocation.getCurrentPositionHighAccuracy().then(()=>{this.checkProximity()}).catch(()=>{})}startWatch(){this.geolocation.startWatching()}stopWatch(){this.geolocation.stopWatching()}bypassLocationCheck(){this.bypassEnabled.set(!0),this.locationGate.enableBypass(),this.router.navigate(["/books"]).catch(t=>console.error("Navigation error",t))}get position(){return this.geolocation.position}get error(){return this.geolocation.error}get accuracy(){return this.geolocation.accuracy}static \u0275fac=function(e){return new(e||i)(C(R),C(Q),C(H))};static \u0275cmp=D({type:i,selectors:[["app-root"]],decls:2,vars:1,consts:[["noPos",""],["outsideZone",""],["class","geo",4,"ngIf"],[1,"geo"],[4,"ngIf"],[4,"ngIf","ngIfElse"],["class","error",4,"ngIf"],[1,"geo-controls"],[3,"click"],[1,"bypass-btn",3,"click"],["class","location-allowed",4,"ngIf","ngIfElse"],[1,"location-allowed"],[1,"location-denied"],[1,"error"]],template:function(e,o){e&1&&(x(0,mt,20,5,"div",2),W(1,"router-outlet")),e&2&&h("ngIf",!o.isWithinAllowedZone()&&!o.bypassEnabled())},dependencies:[F,V,L,q,O],encapsulation:2})};Z(P,et).catch(i=>console.error(i));
